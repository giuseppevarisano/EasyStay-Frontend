<div class="search-container">
  <div class="search-header">
    <div class="welcome-section">
      <h1>ğŸ  EasyStay</h1>
      @if (currentUser) {
        <p class="welcome-message">Benvenuto, <strong>{{ currentUser.nome }}</strong>!</p>
      }
    </div>
    <button class="btn-logout" (click)="logout()">Logout</button>
  </div>

  <div class="search-card">
    <h2>Cerca la tua casa vacanza</h2>
    <p class="subtitle">Compila il form per visualizzare le case disponibili</p>
    
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
      <div class="form-row">
        <div class="form-group">
          <label for="dataInizio">Data Inizio</label>
          <input 
            type="date" 
            id="dataInizio" 
            formControlName="dataInizio"
            [class.invalid]="dataInizio?.invalid && dataInizio?.touched"
          />
          @if (dataInizio?.invalid && dataInizio?.touched) {
            <span class="error-message">Data inizio obbligatoria</span>
          }
        </div>

        <div class="form-group">
          <label for="dataFine">Data Fine</label>
          <input 
            type="date" 
            id="dataFine" 
            formControlName="dataFine"
            [class.invalid]="dataFine?.invalid && dataFine?.touched"
          />
          @if (dataFine?.invalid && dataFine?.touched) {
            <span class="error-message">Data fine obbligatoria</span>
          }
        </div>

        <div class="form-group">
          <label for="citta">CittÃ </label>
          <input 
            type="text" 
            id="citta" 
            formControlName="citta"
            [class.invalid]="citta?.invalid && citta?.touched"
            placeholder="Es: Roma, Milano, Napoli"
          />
          @if (citta?.invalid && citta?.touched) {
            <span class="error-message">CittÃ  obbligatoria</span>
          }
        </div>
      </div>

      @if (errorMessage) {
        <div class="alert alert-error">
          {{ errorMessage }}
        </div>
      }

      <button 
        type="submit" 
        [disabled]="searchForm.invalid || loading"
        class="btn-primary"
      >
        @if (loading) {
          ğŸ” Ricerca in corso...
        } @else {
          ğŸ” Cerca Case
        }
      </button>
    </form>
  </div>

  @if (searched) {
    <div class="results-section">
      <h3>Risultati della ricerca</h3>
      
      @if (loading) {
        <div class="loading-spinner">
          <p>Caricamento...</p>
        </div>
      } @else if (properties.length === 0) {
        <div class="no-results">
          <p>ğŸ˜” Nessuna casa disponibile per le date e la cittÃ  selezionate.</p>
        </div>
      } @else {
        <div class="properties-grid">
          @for (property of properties; track property.id) {
            <div class="property-card">
              <h4>{{ property.nome }}</h4>
              <p class="address">ğŸ“ {{ property.indirizzo }}, {{ property.citta }}</p>
              <p class="price">ğŸ’° {{ property.prezzoNotte }}â‚¬ / notte</p>
              <button class="btn-book">Prenota</button>
            </div>
          }
        </div>
      }
    </div>
  }
</div>